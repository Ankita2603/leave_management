<h1>Employee Leaves</h1>

<table class="table table-bordered table-striped">
  <thead class="table-light">
    <tr>
      <th>Employee</th>
      <th>Start Date</th>
      <th>End Date</th>
      <th>Status</th>
      <th>Reason</th>
      <th>Rejected Reason</th>
      <th>Approver</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <% @leaves.each do |leave| %>
      <tr>
        <td><%= leave.user.name %></td>
        <td><%= leave.start_date.strftime("%Y-%m-%d") %></td>
        <td><%= leave.end_date.strftime("%Y-%m-%d") %></td>
        <td>
          <% status_class = case leave.status
            when "pending" then "text-warning"
            when "accepted" then "text-success"
            when "rejected" then "text-danger"
            else ""
          end %>
          <span class="<%= status_class %>"><%= leave.status.capitalize %></span>
        </td>
        <td><%= leave.reason %></td>
        <td><%= leave.rejection_reason.presence || "-" %></td>
        <td><%= leave.approver&.name || "-" %></td>
        <td>
          <% if leave.pending? && (current_user.manager? || current_user.hr? || current_user.admin?) %>
            <%= link_to 'Approve', approve_leave_application_path(leave), method: :patch, class: "btn btn-sm btn-success" %>
            <%= link_to 'Reject', reject_leave_application_path(leave), method: :patch, class: "btn btn-sm btn-danger" %>
          <% else %>
            -
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
